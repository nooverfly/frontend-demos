<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title></title>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      mapboxgl.accessToken =
        "pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg";
      const map = new mapboxgl.Map({
        container: "map", // container ID
        // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
        // style: "mapbox://styles/mapbox/streets-v11", // style URL
        center: [120, 30], // starting position [lng, lat]
        zoom: 9, // starting zoom
        style: "./style.json",
      });

      fetch("./deviceByCity.json")
        .then((resp) => resp.json())
        .then((deviceByCity) => {
          debugger;
          let deviceData = [];
          for (let k in deviceByCity) {
            const data = deviceByCity[k];
            data.forEach((item) =>
              deviceData.push([item.value[0], item.value[1]])
            );
          }
          var geojson = {
            type: "FeatureCollection",
            features: [
              {
                properties: {},
                type: "Feature",
                geometry: {
                  type: "MultiPoint",
                  coordinates: deviceData,
                },
              },
            ],
          };
          map.addSource("source", {
            type: "geojson",
            data: geojson,
          });

          map.addLayer({
            id: "layer",
            source: "source",

            // 'circle' works
            // 'fill', 'line', 'symbol' don't work - they worked up through version 0.19
            type: "line",
          });
        });
    </script>
  </body>
</html>
